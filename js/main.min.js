let Restaurants,resetRestaurants,addMarkersToMap,createRestaurantHTML,neighborhoods,updateRestaurants,updateRestaurant,event,initMap,fetchNeighborhoods,fillNeighborhoodsHTML,fetchCuisines,fillCuisinesHTML,fillRestaurantsHTML,cuisines,newMap,markers=[];document.addEventListener("DOMContentLoaded",(event)=>{initMap();fetchNeighborhoods();fetchCuisines()});fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{if(error){console.error(error)}else{self.neighborhoods=neighborhoods;fillNeighborhoodsHTML()}})};fillNeighborhoodsHTML=(neighborhoods=self.neighborhoods)=>{const select=document.getElementById("neighborhoods-select");neighborhoods.forEach(neighborhood=>{const option=document.createElement("option");option.innerHTML=neighborhood;option.value=neighborhood;select.append(option)})};fetchCuisines=()=>{DBHelper.fetchCuisines((error,cuisines)=>{if(error){console.error(error)}else{self.cuisines=cuisines;fillCuisinesHTML()}})};fillCuisinesHTML=(cuisines=self.cuisines)=>{const select=document.getElementById("cuisines-select");cuisines.forEach(cuisine=>{const option=document.createElement("option");option.innerHTML=cuisine;option.value=cuisine;select.append(option)})};initMap=()=>{newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token=pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",{mapboxToken:"pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",maxZoom:18,attribution:"Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, "+"<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, "+"Imagery Â© <a href=\"https://www.mapbox.com/\">Mapbox</a>",id:"mapbox.streets"}).addTo(newMap);updateRestaurants()};updateRestaurants=()=>{const cSelect=document.getElementById("cuisines-select");const nSelect=document.getElementById("neighborhoods-select");const cIndex=cSelect.selectedIndex;const nIndex=nSelect.selectedIndex;const cuisine=cSelect[cIndex].value;const neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,(error,restaurants)=>{if(error){console.error(error)}else{resetRestaurants(restaurants);fillRestaurantsHTML()}})};resetRestaurants=(restaurants)=>{self.restaurants=[];const ul=document.getElementById("restaurants-list");ul.innerHTML="";if(self.markers){self.markers.forEach(marker=>marker.remove())}
self.markers=[];self.restaurants=restaurants};fillRestaurantsHTML=(restaurants=self.restaurants)=>{const ul=document.getElementById("restaurants-list");restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant))});addMarkersToMap()};createRestaurantHTML=(restaurant)=>{var offlineRestaurantFromLocalStorage=DBHelper.getRestaurantsFromlocalStorage(restaurant.id);if(offlineRestaurantFromLocalStorage!==undefined&&offlineRestaurantFromLocalStorage.length!==0){var offlineRes=(offlineRestaurantFromLocalStorage);restaurant=offlineRes}
const li=document.createElement("li");li.role="listitem";li.tabIndex=0;const image=document.createElement("img");image.className="restaurant-img";image.src=DBHelper.imageUrlForRestaurant(restaurant);image.alt=restaurant.name;var restaurant_photograph=restaurant.id;var small_images=(restaurant_photograph)+"-1x.webp";var large_images=(restaurant_photograph)+"-2x.webp";image.srcset="images/"+small_images+" 1x"+","+"images/"+large_images+" 2x";image.src="img/"+restaurant_photograph;image.sizes="(max-width: 325px) 100vw 50vw";li.append(image);const div=document.createElement("div");li.append(div);const name=document.createElement("h2");name.innerHTML=restaurant.name;div.append(name);const fav=document.createElement("img");if(restaurant.is_favorite==="true"){fav.src="icons/like.svg";fav.alt="add to favorite";fav.title="add to favourite"}
if(restaurant.is_favorite==="false"){fav.src="icons/unlike.svg";fav.alt="remove from favorite";fav.title="remove to favourite"}
const anchor=document.createElement("a");anchor.onclick=function(){if(restaurant.is_favorite==="true"){restaurant.is_favorite="false";fav.src="icons/unlike.svg"
fav.alt="remove from favorite"}else{restaurant.is_favorite="true";fav.src="icons/like.svg";fav.alt="add to favorite"}
if(window.navigator.onLine){DBHelper.sendRestaurantFavoriteToServer(restaurant.id,restaurant.is_favorite)}else{var existing=localStorage.getItem('restaurant_favorite');existing=existing?JSON.parse(existing):[];existing.push(restaurant);localStorage.setItem('restaurant_favorite',JSON.stringify(existing))}
this.append(fav)}
anchor.append(fav);div.append(anchor);const neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood;div.append(neighborhood);const address=document.createElement("p");address.innerHTML=restaurant.address;div.append(address);const more=document.createElement("button");more.innerHTML="View Details";more.onclick=function(){const url=DBHelper.urlForRestaurant(restaurant);window.location=url};div.append(more);return li};addMarkersToMap=(restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{const marker=DBHelper.mapMarkerForRestaurant(restaurant,self.newMap);marker.on("click",onClick);function onClick(){window.location.href=marker.options.url}
self.markers.push(marker)})}