
'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var dbPromise=idb.open('db',2,function(upgradeDb){switch(upgradeDb.oldVersion){case 0:upgradeDb.createObjectStore('restaurantsList',{keyPath:'id'});case 1:var reviewsStore=upgradeDb.createObjectStore('reviewsList',{keyPath:'id'});reviewsStore.createIndex('restaurant','restaurant_id');}});var DBHelper=function(){function DBHelper(){_classCallCheck(this,DBHelper);}
_createClass(DBHelper,null,[{key:'fetchRestaurants',value:function fetchRestaurants(){return dbPromise.then(function(db){var tx=db.transaction('restaurantsList');var restaurantStore=tx.objectStore('restaurantsList');return restaurantStore.getAll();}).then(function(restaurants){if(restaurants.length!==0){return restaurants;}
return fetch(DBHelper.DATABASE_URL+'restaurants').then(function(response){return response.json();}).then(function(restaurants){return dbPromise.then(function(db){var tx=db.transaction('restaurantsList','readwrite');var restaurantStore=tx.objectStore('restaurantsList');restaurants.forEach(function(restaurant){return restaurantStore.put(restaurant);});tx.complete;return restaurants;});});});}},{key:'fetchReviewsByRestaurantId',value:function fetchReviewsByRestaurantId(id){return fetch(DBHelper.DATABASE_URL+"reviews/?restaurant_id="+id,{method:"GET"}).then(function(resp){return resp.json();}).then(function(reviews){dbPromise.then(function(db){if(!db)return;var tx=db.transaction('reviewsList','readwrite');var reviewsStore=tx.objectStore('reviewsList');if(Array.isArray(reviews)){reviews.forEach(function(review){reviewsStore.put(review);});}else{reviewsStore.put(reviews);}});console.log("reviews from servre",reviews);return reviews;}).catch(function(error){return DBHelper.cacheReviewsFromDb(id);});}},{key:'sendReviewsToServer',value:function sendReviewsToServer(jsonData){var fetch_options={method:'POST',body:JSON.stringify(jsonData),headers:new Headers({'Content-Type':'application/json'})};fetch("http://localhost:1337/reviews",fetch_options).then(function(response){return response.json();}).then(function(data){console.log("Saved reviews successfully");DBHelper.saveReviewsToDatabase(data);}).catch(function(error){return console.log('error:',error);});}},{key:'sendReviewsWhenOnline',value:function sendReviewsWhenOnline(data){DBHelper.saveReviewsTolocalStorage(data);console.log("saving data to local storage",data);window.addEventListener('online',function(event){console.log("online again");var offLineData=DBHelper.getReviewsFromlocalStorage();console.log(offLineData);if(offLineData!==null){DBHelper.sendReviewsToServer(offLineData.data);}
console.log('LocalStorage data sent to server');localStorage.removeItem('reviews');console.log("localStorage + ${offLineData.object_type}   removed");});}},{key:'saveReviewsToDatabase',value:function saveReviewsToDatabase(reviews){dbPromise.then(function(db){if(!db)return;var tx=db.transaction("reviewsList","readwrite");var store=tx.objectStore("reviewsList");if(reviews!==undefined&&Array.isArray(reviews)){reviews.forEach(function(res){store.put(res);});}else{store.put(reviews);}
return tx.complete;});}},{key:'saveReviewsTolocalStorage',value:function saveReviewsTolocalStorage(offlineReviewsList){window.localStorage.setItem("reviews",JSON.stringify(offlineReviewsList));}},{key:'getReviewsFromlocalStorage',value:function getReviewsFromlocalStorage(){return JSON.parse(window.localStorage.getItem("reviews"));}},{key:'fetchRestaurantById',value:function fetchRestaurantById(id){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.find(function(r){return r.id===id;});});}},{key:'fetchRestaurantByCuisine',value:function fetchRestaurantByCuisine(cuisine){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.filter(function(r){return r.cuisine_type==cuisine;});});}},{key:'fetchRestaurantByNeighborhood',value:function fetchRestaurantByNeighborhood(neighborhood){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.filter(function(r){return r.neighborhood==neighborhood;});});}},{key:'fetchRestaurantByCuisineAndNeighborhood',value:function fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood){return DBHelper.fetchRestaurants().then(function(restaurants){var results=restaurants;if(cuisine!=='all'){results=results.filter(function(r){return r.cuisine_type==cuisine;});}
if(neighborhood!=='all'){results=results.filter(function(r){return r.neighborhood==neighborhood;});}
return results;});}},{key:'fetchNeighborhoods',value:function fetchNeighborhoods(){return DBHelper.fetchRestaurants().then(function(restaurants){var neighborhoods=restaurants.map(function(v,i){return restaurants[i].neighborhood;});var uniqueNeighborhoods=neighborhoods.filter(function(v,i){return neighborhoods.indexOf(v)==i;});return uniqueNeighborhoods;});}},{key:'fetchCuisines',value:function fetchCuisines(callback){return DBHelper.fetchRestaurants().then(function(restaurants){var cuisines=restaurants.map(function(v,i){return restaurants[i].cuisine_type;});var uniqueCuisines=cuisines.filter(function(v,i){return cuisines.indexOf(v)==i;});return uniqueCuisines;});}},{key:'updateFavouriteStatus',value:function updateFavouriteStatus(restaurantId,isFavourite){console.log('changing favorite status to: ',isFavourite);fetch('http://localhost:1337/restaurants/'+restaurantId+'/?is_favorite='+isFavourite,{method:'PUT'}).then(function(){dbPromise.then(function(db){var tx=db.transaction('restaurantsList','readwrite');var restaurantsStore=tx.objectStore('restaurantsList');restaurantsStore.get(restaurantId).then(function(restaurant){restaurant.is_favorite=isFavourite;restaurantsStore.put(restaurant);});});});}},{key:'cacheReviewsFromDb',value:function cacheReviewsFromDb(id){var reviews=dbPromise.then(function(db){var tx=db.transaction("reviewsList","readonly");var store=tx.objectStore("reviewsList");return store.getAll(id);});return reviews;}},{key:'urlForRestaurant',value:function urlForRestaurant(restaurant){return'./restaurant.html?id='+restaurant.id;}},{key:'imageUrlForRestaurant',value:function imageUrlForRestaurant(restaurant){return'/img/'+restaurant.photograph+'.webp';}},{key:'mapMarkerForRestaurant',value:function mapMarkerForRestaurant(restaurant){var marker=new L.marker([restaurant.latlng.lat,restaurant.latlng.lng],{title:restaurant.name,alt:restaurant.name,url:DBHelper.urlForRestaurant(restaurant)});marker.addTo(newMap);return marker;}},{key:'DATABASE_URL',get:function get(){var port=1337;return'http://localhost:'+port+'/';}}]);return DBHelper;}();'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var dbPromise=idb.open('db',2,function(upgradeDb){switch(upgradeDb.oldVersion){case 0:upgradeDb.createObjectStore('restaurantsList',{keyPath:'id'});case 1:var reviewsStore=upgradeDb.createObjectStore('reviewsList',{keyPath:'id'});reviewsStore.createIndex('restaurant','restaurant_id');}});var DBHelper=function(){function DBHelper(){_classCallCheck(this,DBHelper);}
_createClass(DBHelper,null,[{key:'fetchRestaurants',value:function fetchRestaurants(){return dbPromise.then(function(db){var tx=db.transaction('restaurantsList');var restaurantStore=tx.objectStore('restaurantsList');return restaurantStore.getAll();}).then(function(restaurants){if(restaurants.length!==0){return restaurants;}
return fetch(DBHelper.DATABASE_URL+'restaurants').then(function(response){return response.json();}).then(function(restaurants){return dbPromise.then(function(db){var tx=db.transaction('restaurantsList','readwrite');var restaurantStore=tx.objectStore('restaurantsList');restaurants.forEach(function(restaurant){return restaurantStore.put(restaurant);});tx.complete;return restaurants;});});});}},{key:'fetchReviewsByRestaurantId',value:function fetchReviewsByRestaurantId(id){return fetch(DBHelper.DATABASE_URL+"reviews/?restaurant_id="+id,{method:"GET"}).then(function(resp){return resp.json();}).then(function(reviews){dbPromise.then(function(db){if(!db)return;var tx=db.transaction('reviewsList','readwrite');var reviewsStore=tx.objectStore('reviewsList');if(Array.isArray(reviews)){reviews.forEach(function(review){reviewsStore.put(review);});}else{reviewsStore.put(reviews);}});console.log("reviews from servre",reviews);return reviews;}).catch(function(error){return DBHelper.cacheReviewsFromDb(id);});}},{key:'sendReviewsToServer',value:function sendReviewsToServer(jsonData){var fetch_options={method:'POST',body:JSON.stringify(jsonData),headers:new Headers({'Content-Type':'application/json'})};fetch("http://localhost:1337/reviews",fetch_options).then(function(response){return response.json();}).then(function(data){console.log("Saved reviews successfully");DBHelper.saveReviewsToDatabase(data);}).catch(function(error){return console.log('error:',error);});}},{key:'sendReviewsWhenOnline',value:function sendReviewsWhenOnline(data){DBHelper.saveReviewsTolocalStorage(data);console.log("saving data to local storage",data);window.addEventListener('online',function(event){console.log("online again");var offLineData=DBHelper.getReviewsFromlocalStorage();console.log(offLineData);if(offLineData!==null){DBHelper.sendReviewsToServer(offLineData.data);}
console.log('LocalStorage data sent to server');localStorage.removeItem('reviews');console.log("localStorage + ${offLineData.object_type}   removed");});}},{key:'saveReviewsToDatabase',value:function saveReviewsToDatabase(reviews){dbPromise.then(function(db){if(!db)return;var tx=db.transaction("reviewsList","readwrite");var store=tx.objectStore("reviewsList");if(reviews!==undefined&&Array.isArray(reviews)){reviews.forEach(function(res){store.put(res);});}else{store.put(reviews);}
return tx.complete;});}},{key:'saveReviewsTolocalStorage',value:function saveReviewsTolocalStorage(offlineReviewsList){window.localStorage.setItem("reviews",JSON.stringify(offlineReviewsList));}},{key:'getReviewsFromlocalStorage',value:function getReviewsFromlocalStorage(){return JSON.parse(window.localStorage.getItem("reviews"));}},{key:'fetchRestaurantById',value:function fetchRestaurantById(id){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.find(function(r){return r.id===id;});});}},{key:'fetchRestaurantByCuisine',value:function fetchRestaurantByCuisine(cuisine){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.filter(function(r){return r.cuisine_type==cuisine;});});}},{key:'fetchRestaurantByNeighborhood',value:function fetchRestaurantByNeighborhood(neighborhood){return DBHelper.fetchRestaurants().then(function(restaurants){return restaurants.filter(function(r){return r.neighborhood==neighborhood;});});}},{key:'fetchRestaurantByCuisineAndNeighborhood',value:function fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood){return DBHelper.fetchRestaurants().then(function(restaurants){var results=restaurants;if(cuisine!=='all'){results=results.filter(function(r){return r.cuisine_type==cuisine;});}
if(neighborhood!=='all'){results=results.filter(function(r){return r.neighborhood==neighborhood;});}
return results;});}},{key:'fetchNeighborhoods',value:function fetchNeighborhoods(){return DBHelper.fetchRestaurants().then(function(restaurants){var neighborhoods=restaurants.map(function(v,i){return restaurants[i].neighborhood;});var uniqueNeighborhoods=neighborhoods.filter(function(v,i){return neighborhoods.indexOf(v)==i;});return uniqueNeighborhoods;});}},{key:'fetchCuisines',value:function fetchCuisines(callback){return DBHelper.fetchRestaurants().then(function(restaurants){var cuisines=restaurants.map(function(v,i){return restaurants[i].cuisine_type;});var uniqueCuisines=cuisines.filter(function(v,i){return cuisines.indexOf(v)==i;});return uniqueCuisines;});}},{key:'updateFavouriteStatus',value:function updateFavouriteStatus(restaurantId,isFavourite){console.log('changing favorite status to: ',isFavourite);fetch('http://localhost:1337/restaurants/'+restaurantId+'/?is_favorite='+isFavourite,{method:'PUT'}).then(function(){dbPromise.then(function(db){var tx=db.transaction('restaurantsList','readwrite');var restaurantsStore=tx.objectStore('restaurantsList');restaurantsStore.get(restaurantId).then(function(restaurant){restaurant.is_favorite=isFavourite;restaurantsStore.put(restaurant);});});});}},{key:'cacheReviewsFromDb',value:function cacheReviewsFromDb(id){var reviews=dbPromise.then(function(db){var tx=db.transaction("reviewsList","readonly");var store=tx.objectStore("reviewsList");return store.getAll(id);});return reviews;}},{key:'urlForRestaurant',value:function urlForRestaurant(restaurant){return'./restaurant.html?id='+restaurant.id;}},{key:'imageUrlForRestaurant',value:function imageUrlForRestaurant(restaurant){return'/img/'+restaurant.photograph+'.webp';}},{key:'mapMarkerForRestaurant',value:function mapMarkerForRestaurant(restaurant){var marker=new L.marker([restaurant.latlng.lat,restaurant.latlng.lng],{title:restaurant.name,alt:restaurant.name,url:DBHelper.urlForRestaurant(restaurant)});marker.addTo(newMap);return marker;}},{key:'DATABASE_URL',get:function get(){var port=1337;return'http://localhost:'+port+'/';}}]);return DBHelper;}();"use strict";(function(){function toArray(arr){return Array.prototype.slice.call(arr);}
function promisifyRequest(request){return new Promise(function(resolve,reject){request.onsuccess=function(){resolve(request.result);};request.onerror=function(){reject(request.error);};});}
function promisifyRequestCall(obj,method,args){var request;var p=new Promise(function(resolve,reject){request=obj[method].apply(obj,args);promisifyRequest(request).then(resolve,reject);});p.request=request;return p;}
function promisifyCursorRequestCall(obj,method,args){var p=promisifyRequestCall(obj,method,args);return p.then(function(value){if(!value)return;return new Cursor(value,p.request);});}
function proxyProperties(ProxyClass,targetProp,properties){properties.forEach(function(prop){Object.defineProperty(ProxyClass.prototype,prop,{get:function get(){return this[targetProp][prop];},set:function set(val){this[targetProp][prop]=val;}});});}
function proxyRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyRequestCall(this[targetProp],prop,arguments);};});}
function proxyMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return this[targetProp][prop].apply(this[targetProp],arguments);};});}
function proxyCursorRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyCursorRequestCall(this[targetProp],prop,arguments);};});}
function Index(index){this._index=index;}
proxyProperties(Index,"_index",["name","keyPath","multiEntry","unique"]);proxyRequestMethods(Index,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]);proxyCursorRequestMethods(Index,"_index",IDBIndex,["openCursor","openKeyCursor"]);function Cursor(cursor,request){this._cursor=cursor;this._request=request;}
proxyProperties(Cursor,"_cursor",["direction","key","primaryKey","value"]);proxyRequestMethods(Cursor,"_cursor",IDBCursor,["update","delete"]);["advance","continue","continuePrimaryKey"].forEach(function(methodName){if(!(methodName in IDBCursor.prototype))return;Cursor.prototype[methodName]=function(){var cursor=this;var args=arguments;return Promise.resolve().then(function(){cursor._cursor[methodName].apply(cursor._cursor,args);return promisifyRequest(cursor._request).then(function(value){if(!value)return;return new Cursor(value,cursor._request);});});};});function ObjectStore(store){this._store=store;}
ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments));};ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments));};proxyProperties(ObjectStore,"_store",["name","keyPath","indexNames","autoIncrement"]);proxyRequestMethods(ObjectStore,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]);proxyCursorRequestMethods(ObjectStore,"_store",IDBObjectStore,["openCursor","openKeyCursor"]);proxyMethods(ObjectStore,"_store",IDBObjectStore,["deleteIndex"]);function Transaction(idbTransaction){this._tx=idbTransaction;this.complete=new Promise(function(resolve,reject){idbTransaction.oncomplete=function(){resolve();};idbTransaction.onerror=function(){reject(idbTransaction.error);};idbTransaction.onabort=function(){reject(idbTransaction.error);};});}
Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments));};proxyProperties(Transaction,"_tx",["objectStoreNames","mode"]);proxyMethods(Transaction,"_tx",IDBTransaction,["abort"]);function UpgradeDB(db,oldVersion,transaction){this._db=db;this.oldVersion=oldVersion;this.transaction=new Transaction(transaction);}
UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments));};proxyProperties(UpgradeDB,"_db",["name","version","objectStoreNames"]);proxyMethods(UpgradeDB,"_db",IDBDatabase,["deleteObjectStore","close"]);function DB(db){this._db=db;}
DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments));};proxyProperties(DB,"_db",["name","version","objectStoreNames"]);proxyMethods(DB,"_db",IDBDatabase,["close"]);["openCursor","openKeyCursor"].forEach(function(funcName){[ObjectStore,Index].forEach(function(Constructor){if(!(funcName in Constructor.prototype))return;Constructor.prototype[funcName.replace("open","iterate")]=function(){var args=toArray(arguments);var callback=args[args.length-1];var nativeObject=this._store||this._index;var request=nativeObject[funcName].apply(nativeObject,args.slice(0,-1));request.onsuccess=function(){callback(request.result);};};});});[Index,ObjectStore].forEach(function(Constructor){if(Constructor.prototype.getAll)return;Constructor.prototype.getAll=function(query,count){var instance=this;var items=[];return new Promise(function(resolve){instance.iterateCursor(query,function(cursor){if(!cursor){resolve(items);return;}
items.push(cursor.value);if(count!==undefined&&items.length==count){resolve(items);return;}
cursor.continue();});});};});var exp={open:function open(name,version,upgradeCallback){var p=promisifyRequestCall(indexedDB,"open",[name,version]);var request=p.request;if(request){request.onupgradeneeded=function(event){if(upgradeCallback){upgradeCallback(new UpgradeDB(request.result,event.oldVersion,request.transaction));}};}
return p.then(function(db){return new DB(db);});},delete:function _delete(name){return promisifyRequestCall(indexedDB,"deleteDatabase",[name]);}};if(typeof module!=="undefined"){module.exports=exp;module.exports.default=module.exports;}else{self.idb=exp;}})();"use strict";(function(){function toArray(arr){return Array.prototype.slice.call(arr);}
function promisifyRequest(request){return new Promise(function(resolve,reject){request.onsuccess=function(){resolve(request.result);};request.onerror=function(){reject(request.error);};});}
function promisifyRequestCall(obj,method,args){var request;var p=new Promise(function(resolve,reject){request=obj[method].apply(obj,args);promisifyRequest(request).then(resolve,reject);});p.request=request;return p;}
function promisifyCursorRequestCall(obj,method,args){var p=promisifyRequestCall(obj,method,args);return p.then(function(value){if(!value)return;return new Cursor(value,p.request);});}
function proxyProperties(ProxyClass,targetProp,properties){properties.forEach(function(prop){Object.defineProperty(ProxyClass.prototype,prop,{get:function get(){return this[targetProp][prop];},set:function set(val){this[targetProp][prop]=val;}});});}
function proxyRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyRequestCall(this[targetProp],prop,arguments);};});}
function proxyMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return this[targetProp][prop].apply(this[targetProp],arguments);};});}
function proxyCursorRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyCursorRequestCall(this[targetProp],prop,arguments);};});}
function Index(index){this._index=index;}
proxyProperties(Index,"_index",["name","keyPath","multiEntry","unique"]);proxyRequestMethods(Index,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]);proxyCursorRequestMethods(Index,"_index",IDBIndex,["openCursor","openKeyCursor"]);function Cursor(cursor,request){this._cursor=cursor;this._request=request;}
proxyProperties(Cursor,"_cursor",["direction","key","primaryKey","value"]);proxyRequestMethods(Cursor,"_cursor",IDBCursor,["update","delete"]);["advance","continue","continuePrimaryKey"].forEach(function(methodName){if(!(methodName in IDBCursor.prototype))return;Cursor.prototype[methodName]=function(){var cursor=this;var args=arguments;return Promise.resolve().then(function(){cursor._cursor[methodName].apply(cursor._cursor,args);return promisifyRequest(cursor._request).then(function(value){if(!value)return;return new Cursor(value,cursor._request);});});};});function ObjectStore(store){this._store=store;}
ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments));};ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments));};proxyProperties(ObjectStore,"_store",["name","keyPath","indexNames","autoIncrement"]);proxyRequestMethods(ObjectStore,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]);proxyCursorRequestMethods(ObjectStore,"_store",IDBObjectStore,["openCursor","openKeyCursor"]);proxyMethods(ObjectStore,"_store",IDBObjectStore,["deleteIndex"]);function Transaction(idbTransaction){this._tx=idbTransaction;this.complete=new Promise(function(resolve,reject){idbTransaction.oncomplete=function(){resolve();};idbTransaction.onerror=function(){reject(idbTransaction.error);};idbTransaction.onabort=function(){reject(idbTransaction.error);};});}
Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments));};proxyProperties(Transaction,"_tx",["objectStoreNames","mode"]);proxyMethods(Transaction,"_tx",IDBTransaction,["abort"]);function UpgradeDB(db,oldVersion,transaction){this._db=db;this.oldVersion=oldVersion;this.transaction=new Transaction(transaction);}
UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments));};proxyProperties(UpgradeDB,"_db",["name","version","objectStoreNames"]);proxyMethods(UpgradeDB,"_db",IDBDatabase,["deleteObjectStore","close"]);function DB(db){this._db=db;}
DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments));};proxyProperties(DB,"_db",["name","version","objectStoreNames"]);proxyMethods(DB,"_db",IDBDatabase,["close"]);["openCursor","openKeyCursor"].forEach(function(funcName){[ObjectStore,Index].forEach(function(Constructor){if(!(funcName in Constructor.prototype))return;Constructor.prototype[funcName.replace("open","iterate")]=function(){var args=toArray(arguments);var callback=args[args.length-1];var nativeObject=this._store||this._index;var request=nativeObject[funcName].apply(nativeObject,args.slice(0,-1));request.onsuccess=function(){callback(request.result);};};});});[Index,ObjectStore].forEach(function(Constructor){if(Constructor.prototype.getAll)return;Constructor.prototype.getAll=function(query,count){var instance=this;var items=[];return new Promise(function(resolve){instance.iterateCursor(query,function(cursor){if(!cursor){resolve(items);return;}
items.push(cursor.value);if(count!==undefined&&items.length==count){resolve(items);return;}
cursor.continue();});});};});var exp={open:function open(name,version,upgradeCallback){var p=promisifyRequestCall(indexedDB,"open",[name,version]);var request=p.request;if(request){request.onupgradeneeded=function(event){if(upgradeCallback){upgradeCallback(new UpgradeDB(request.result,event.oldVersion,request.transaction));}};}
return p.then(function(db){return new DB(db);});},delete:function _delete(name){return promisifyRequestCall(indexedDB,"deleteDatabase",[name]);}};if(typeof module!=="undefined"){module.exports=exp;module.exports.default=module.exports;}else{self.idb=exp;}})();"use strict";var Restaurants=void 0,resetRestaurants=void 0,addMarkersToMap=void 0,createRestaurantHTML=void 0,neighborhoods=void 0,updateRestaurants=void 0,updateRestaurant=void 0,event=void 0,initMap=void 0,fetchNeighborhoods=void 0,fillNeighborhoodsHTML=void 0,fetchCuisines=void 0,fillCuisinesHTML=void 0,fillRestaurantsHTML=void 0,cuisines=void 0,newMap=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(event){initMap();fetchNeighborhoods();fetchCuisines();});fetchNeighborhoods=function fetchNeighborhoods(){DBHelper.fetchNeighborhoods().then(function(neighborhoods){self.neighborhoods=neighborhoods;fillNeighborhoodsHTML();}).catch(function(error){return console.error(error);});};fillNeighborhoodsHTML=function fillNeighborhoodsHTML(){var neighborhoods=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.neighborhoods;var select=document.getElementById("neighborhoods-select");neighborhoods.forEach(function(neighborhood){var option=document.createElement("option");option.innerHTML=neighborhood;option.value=neighborhood;select.append(option);});};fetchCuisines=function fetchCuisines(){DBHelper.fetchCuisines().then(function(cuisines){self.cuisines=cuisines;fillCuisinesHTML();}).catch(function(error){return console.log(error);});};fillCuisinesHTML=function fillCuisinesHTML(){var cuisines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.cuisines;var select=document.getElementById("cuisines-select");cuisines.forEach(function(cuisine){var option=document.createElement("option");option.innerHTML=cuisine;option.value=cuisine;select.append(option);});};initMap=function initMap(){newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:false});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token=pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",{mapboxToken:"pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",maxZoom:18,attribution:"Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, "+"<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, "+"Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>",id:"mapbox.streets"}).addTo(newMap);updateRestaurants();};updateRestaurants=function updateRestaurants(){var cSelect=document.getElementById("cuisines-select");var nSelect=document.getElementById("neighborhoods-select");var cIndex=cSelect.selectedIndex;var nIndex=nSelect.selectedIndex;var cuisine=cSelect[cIndex].value;var neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood).then(function(restaurants){resetRestaurants(restaurants);fillRestaurantsHTML();}).catch(function(error){return console.error(error);});};resetRestaurants=function resetRestaurants(restaurants){self.restaurants=[];var ul=document.getElementById("restaurants-list");ul.innerHTML="";if(self.markers){self.markers.forEach(function(marker){return marker.remove();});}
self.markers=[];self.restaurants=restaurants;};fillRestaurantsHTML=function fillRestaurantsHTML(){var restaurants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurants;var ul=document.getElementById("restaurants-list");restaurants.forEach(function(restaurant){ul.append(createRestaurantHTML(restaurant));});addMarkersToMap();};createRestaurantHTML=function createRestaurantHTML(restaurant){var li=document.createElement("li");li.role="listitem";li.tabIndex=0;var image=document.createElement("img");image.alt=restaurant.name;var restaurant_photograph=restaurant.id;var small_images=restaurant_photograph+"-1x.webp";var large_images=restaurant_photograph+"-2x.webp";var options={threshold:0.2};var observer=void 0;if('IntersectionObserver'in window){observer=new IntersectionObserver(events,options);observer.observe(image);}else{displayImages(image);}
var displayImages=function displayImages(image){image.className='restaurant-img';image.classNmae="sunitha";image.src=DBHelper.imageUrlForRestaurant(restaurant);image.srcset="images/"+small_images+" 1x"+","+"images/"+large_images+" 2x";image.src="img/"+restaurant_photograph+".jpg";image.sizes="(max-width: 325px) 100vw 50vw";};function events(events,observer){events.forEach(function(event){if(event.intersectionRatio>0){displayImages(event.target);observer.unobserve(event.target);}else{}});}
li.append(image);var div=document.createElement("div");li.append(div);var name=document.createElement("h2");name.innerHTML=restaurant.name;div.append(name);var fav=document.createElement("img");fav.setAttribute('tabIndex',0);changeFavIcon(fav,restaurant['is_favorite']);var anchor=document.createElement("a");anchor.onclick=function(){var isFavNow=!restaurant['is_favorite'];DBHelper.updateFavouriteStatus(restaurant.id,isFavNow);restaurant.is_favorite=!restaurant.is_favorite;changeFavIcon(fav,JSON.parse(restaurant.is_favorite));this.append(fav);};anchor.append(fav);div.append(anchor);var neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood;div.append(neighborhood);var address=document.createElement("p");address.innerHTML=restaurant.address;div.append(address);var more=document.createElement("button");more.innerHTML="View Details";more.onclick=function(){var url=DBHelper.urlForRestaurant(restaurant);window.location=url;};div.append(more);return li;};changeFavIcon=function changeFavIcon(el,isFav){if(!isFav){el.src="icons/unlike.svg";el.alt="add to favorite";el.title="add to favourite";}else{el.src="icons/like.svg";el.alt="remove from favorite";el.title="remove from favourite";}};addMarkersToMap=function addMarkersToMap(){var restaurants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurants;restaurants.forEach(function(restaurant){var marker=DBHelper.mapMarkerForRestaurant(restaurant,self.newMap);marker.on("click",onClick);function onClick(){window.location.href=marker.options.url;}
self.markers.push(marker);});};"use strict";var Restaurants=void 0,resetRestaurants=void 0,addMarkersToMap=void 0,createRestaurantHTML=void 0,neighborhoods=void 0,updateRestaurants=void 0,updateRestaurant=void 0,event=void 0,initMap=void 0,fetchNeighborhoods=void 0,fillNeighborhoodsHTML=void 0,fetchCuisines=void 0,fillCuisinesHTML=void 0,fillRestaurantsHTML=void 0,cuisines=void 0,newMap=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(event){initMap();fetchNeighborhoods();fetchCuisines();});fetchNeighborhoods=function fetchNeighborhoods(){DBHelper.fetchNeighborhoods().then(function(neighborhoods){self.neighborhoods=neighborhoods;fillNeighborhoodsHTML();}).catch(function(error){return console.error(error);});};fillNeighborhoodsHTML=function fillNeighborhoodsHTML(){var neighborhoods=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.neighborhoods;var select=document.getElementById("neighborhoods-select");neighborhoods.forEach(function(neighborhood){var option=document.createElement("option");option.innerHTML=neighborhood;option.value=neighborhood;select.append(option);});};fetchCuisines=function fetchCuisines(){DBHelper.fetchCuisines().then(function(cuisines){self.cuisines=cuisines;fillCuisinesHTML();}).catch(function(error){return console.log(error);});};fillCuisinesHTML=function fillCuisinesHTML(){var cuisines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.cuisines;var select=document.getElementById("cuisines-select");cuisines.forEach(function(cuisine){var option=document.createElement("option");option.innerHTML=cuisine;option.value=cuisine;select.append(option);});};initMap=function initMap(){newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token=pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",{mapboxToken:"pk.eyJ1Ijoic2ZyZW5zIiwiYSI6ImNqaWVzeWJnMjBwb3Yzc3Q0bml3OGo5bnQifQ.XLzOLAtnX3pMu70zmA5YlQ",maxZoom:18,attribution:"Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, "+"<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, "+"Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>",id:"mapbox.streets"}).addTo(newMap);updateRestaurants();};updateRestaurants=function updateRestaurants(){var cSelect=document.getElementById("cuisines-select");var nSelect=document.getElementById("neighborhoods-select");var cIndex=cSelect.selectedIndex;var nIndex=nSelect.selectedIndex;var cuisine=cSelect[cIndex].value;var neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood).then(function(restaurants){resetRestaurants(restaurants);fillRestaurantsHTML();}).catch(function(error){return console.error(error);});};resetRestaurants=function resetRestaurants(restaurants){self.restaurants=[];var ul=document.getElementById("restaurants-list");ul.innerHTML="";if(self.markers){self.markers.forEach(function(marker){return marker.remove();});}
self.markers=[];self.restaurants=restaurants;};fillRestaurantsHTML=function fillRestaurantsHTML(){var restaurants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurants;var ul=document.getElementById("restaurants-list");restaurants.forEach(function(restaurant){ul.append(createRestaurantHTML(restaurant));});addMarkersToMap();};createRestaurantHTML=function createRestaurantHTML(restaurant){var li=document.createElement("li");li.role="listitem";li.tabIndex=0;var image=document.createElement("img");image.alt=restaurant.name;var restaurant_photograph=restaurant.id;var small_images=restaurant_photograph+"-1x.webp";var large_images=restaurant_photograph+"-2x.webp";var options={threshold:0.2};var observer=void 0;if('IntersectionObserver'in window){observer=new IntersectionObserver(events,options);observer.observe(image);}else{displayImages(image);}
var displayImages=function displayImages(image){image.className='restaurant-img';image.classNmae="sunitha";image.src=DBHelper.imageUrlForRestaurant(restaurant);image.srcset="images/"+small_images+" 1x"+","+"images/"+large_images+" 2x";image.src="img/"+restaurant_photograph+".jpg";image.sizes="(max-width: 325px) 100vw 50vw";};function events(events,observer){events.forEach(function(event){if(event.intersectionRatio>0){displayImages(event.target);observer.unobserve(event.target);}else{}});}
li.append(image);var div=document.createElement("div");li.append(div);var name=document.createElement("h2");name.innerHTML=restaurant.name;div.append(name);var fav=document.createElement("img");fav.setAttribute('tabIndex',0);changeFavIcon(fav,restaurant.is_favorite);var anchor=document.createElement("a");anchor.onclick=function(){var isFavNow=!restaurant.is_favorite;DBHelper.updateFavouriteStatus(restaurant.id,isFavNow);restaurant.is_favorite=!restaurant.is_favorite;changeFavIcon(fav,JSON.parse(restaurant.is_favorite));this.append(fav);};anchor.append(fav);div.append(anchor);var neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood;div.append(neighborhood);var address=document.createElement("p");address.innerHTML=restaurant.address;div.append(address);var more=document.createElement("button");more.innerHTML="View Details";more.onclick=function(){var url=DBHelper.urlForRestaurant(restaurant);window.location=url;};div.append(more);return li;};changeFavIcon=function changeFavIcon(el,isFav){if(!isFav){el.src="icons/unlike.svg";el.alt="add to favorite";el.title="add to favourite";}else{el.src="icons/like.svg";el.alt="remove from favorite";el.title="remove from favourite";}};addMarkersToMap=function addMarkersToMap(){var restaurants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurants;restaurants.forEach(function(restaurant){var marker=DBHelper.mapMarkerForRestaurant(restaurant,self.newMap);marker.on("click",onClick);function onClick(){window.location.href=marker.options.url;}
self.markers.push(marker);});};'use strict';var restaurant=void 0,reviews=void 0,initMap=void 0,fetchRestaurantFromURL=void 0,fillRestaurantHTML=void 0,getParameterByName=void 0,fillRestaurantHoursHTML=void 0,fillReviewsHTML=void 0,createReviewHTML=void 0,fillBreadcrumb=void 0,event=void 0;var newMap,addReview;var offlineReviews=[];var offlineReviewsFromLocalStorage=[];document.addEventListener("DOMContentLoaded",function(event){initMap();});initMap=function initMap(){fetchRestaurantFromURL().then(function(restaurant){self.newMap=L.map('map',{center:[restaurant.latlng.lat,restaurant.latlng.lng],zoom:16,scrollWheelZoom:false});L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}',{mapboxToken:'pk.eyJ1IjoibXJwdW1wa2luZyIsImEiOiJjamoyNXUzcDIwenpyM2tsZm03MDJnOHFqIn0.K5wTgEieIuewCzBwoLVGRw',maxZoom:18,attribution:'',id:'mapbox.streets'}).addTo(newMap);fillBreadcrumb();DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap);}).catch(function(error){return console.error(error);});};fetchRestaurantFromURL=function fetchRestaurantFromURL(){if(self.restaurant){return Promise.resolve(self.restaurant);}
var id=parseInt(getParameterByName('id'));if(!id||id===NaN){return Promise.reject('No restaurant id in URL');}else{return DBHelper.fetchRestaurantById(id).then(function(restaurant){if(!restaurant){return Promise.reject('Restaurant with ID '+id+' was not found');}
self.restaurant=restaurant;fillRestaurantHTML();return restaurant;});}};fillRestaurantHTML=function fillRestaurantHTML(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var name=document.getElementById("restaurant-name");name.innerHTML=restaurant.name;var address=document.getElementById("restaurant-address");address.innerHTML=restaurant.address;var image=document.getElementById("restaurant-img");image.alt=restaurant.name;var restaurant_photograph=restaurant.id;var small_images=restaurant_photograph+"_300.webp";var large_images=restaurant_photograph+"_600.webp";image.sizes="(max-width: 325px) 100vw 50vw";var options={threshold:0.2};var observer=void 0;if('IntersectionObserver'in window){observer=new IntersectionObserver(events,options);observer.observe(image);}else{displayImages(image);}
var displayImages=function displayImages(image){image.className='restaurant-img';image.src=DBHelper.imageUrlForRestaurant(restaurant);image.srcset="banners/"+small_images+" 1x"+","+"banners/"+large_images+" 2x";};function events(events,observer){events.forEach(function(event){if(event.intersectionRatio>0){displayImages(event.target);observer.unobserve(event.target);}else{}});}
var cuisine=document.getElementById("restaurant-cuisine");cuisine.innerHTML=restaurant.cuisine_type;if(restaurant.operating_hours){fillRestaurantHoursHTML();}
DBHelper.fetchReviewsByRestaurantId(restaurant.id).then(function(reviews){return fillReviewsHTML(reviews);});};fillRestaurantHoursHTML=function fillRestaurantHoursHTML(){var operatingHours=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant.operating_hours;var hours=document.getElementById("restaurant-hours");for(var key in operatingHours){var row=document.createElement("tr");var day=document.createElement("td");day.innerHTML=key;row.appendChild(day);var time=document.createElement("td");time.innerHTML=operatingHours[key];row.appendChild(time);hours.appendChild(row);}};fillReviewsHTML=function fillReviewsHTML(){var reviews=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant.reviews;var container=document.getElementById("reviews-container");var title=document.createElement("h2");title.innerHTML="Reviews";container.appendChild(title);var id=parseInt(getParameterByName('id'));if(!reviews){var noReviews=document.createElement("p");noReviews.innerHTML="No reviews yet!";container.appendChild(noReviews);return;}
var ul=document.getElementById("reviews-list");reviews.forEach(function(review){ul.appendChild(createReviewHTML(review));});container.appendChild(ul);};createReviewHTML=function createReviewHTML(review){var li=document.createElement("li");li.tabIndex=0;var name=document.createElement("p");name.innerHTML=review.name;li.appendChild(name);var date=document.createElement("p");var convertedDate=new Date(review.createdAt).toLocaleString();date.innerHTML=convertedDate;li.appendChild(date);var rating=document.createElement("p");rating.innerHTML='Rating: '+review.rating;li.appendChild(rating);var comments=document.createElement("p");comments.innerHTML=review.comments;li.appendChild(comments);return li;};addReview=function addReview(){console.log("clicked submit");var url=window.location.href;var id=getParameterByName('id');var name=document.getElementById('reviewer_name').value;var rating=document.getElementById('select_rating');var rating_value=rating.options[rating.selectedIndex].value;var comment=document.getElementById('reviewer_comment').value;if(name==""){alert("Name must be filled out");return false;}else if(comment==""){alert("Comment must be filled out");return false;}else{var jsonToSend={"restaurant_id":id,"name":name,"createdAt":new Date(),"rating":rating_value,"comments":comment};var offline_obj={data:jsonToSend,name:'addReview',object_type:"review"};if(!navigator.onLine&&offline_obj.name==='addReview'){DBHelper.sendReviewsWhenOnline(offline_obj);var _container=document.getElementById("reviews-container");var _ul=document.getElementById("reviews-list");_ul.insertBefore(createReviewHTML(offline_obj.data),_ul.childNodes[0]);_container.appendChild(_ul);var reviewForm=document.getElementById('reviewForm');reviewForm.reset();return;}
console.log("sending reviews",jsonToSend);DBHelper.sendReviewsToServer(jsonToSend);var container=document.getElementById("reviews-container");var ul=document.getElementById("reviews-list");ul.insertBefore(createReviewHTML(jsonToSend),ul.childNodes[0]);container.appendChild(ul);var reviewForm=document.getElementById('reviewForm');reviewForm.reset();}};fillBreadcrumb=function fillBreadcrumb(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var breadcrumb=document.getElementById("breadcrumb");var li=document.createElement("li");li.innerHTML=restaurant.name;breadcrumb.appendChild(li);};getParameterByName=function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)'),results=regex.exec(url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "));};'use strict';var restaurant=void 0,reviews=void 0,initMap=void 0,fetchRestaurantFromURL=void 0,fillRestaurantHTML=void 0,getParameterByName=void 0,fillRestaurantHoursHTML=void 0,fillReviewsHTML=void 0,createReviewHTML=void 0,fillBreadcrumb=void 0,event=void 0;var newMap,addReview;var offlineReviews=[];var offlineReviewsFromLocalStorage=[];document.addEventListener("DOMContentLoaded",function(event){initMap();});initMap=function initMap(){fetchRestaurantFromURL().then(function(restaurant){self.newMap=L.map('map',{center:[restaurant.latlng.lat,restaurant.latlng.lng],zoom:16,scrollWheelZoom:!1});L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}',{mapboxToken:'pk.eyJ1IjoibXJwdW1wa2luZyIsImEiOiJjamoyNXUzcDIwenpyM2tsZm03MDJnOHFqIn0.K5wTgEieIuewCzBwoLVGRw',maxZoom:18,attribution:'',id:'mapbox.streets'}).addTo(newMap);fillBreadcrumb();DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap);}).catch(function(error){return console.error(error);});};fetchRestaurantFromURL=function fetchRestaurantFromURL(){if(self.restaurant){return Promise.resolve(self.restaurant);}
var id=parseInt(getParameterByName('id'));if(!id||id===NaN){return Promise.reject('No restaurant id in URL');}else{return DBHelper.fetchRestaurantById(id).then(function(restaurant){if(!restaurant){return Promise.reject('Restaurant with ID '+id+' was not found');}
self.restaurant=restaurant;fillRestaurantHTML();return restaurant;});}};fillRestaurantHTML=function fillRestaurantHTML(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var name=document.getElementById("restaurant-name");name.innerHTML=restaurant.name;var address=document.getElementById("restaurant-address");address.innerHTML=restaurant.address;var image=document.getElementById("restaurant-img");image.alt=restaurant.name;var restaurant_photograph=restaurant.id;var small_images=restaurant_photograph+"_300.webp";var large_images=restaurant_photograph+"_600.webp";image.sizes="(max-width: 325px) 100vw 50vw";var options={threshold:0.2};var observer=void 0;if('IntersectionObserver'in window){observer=new IntersectionObserver(events,options);observer.observe(image);}else{displayImages(image);}
var displayImages=function displayImages(image){image.className='restaurant-img';image.src=DBHelper.imageUrlForRestaurant(restaurant);image.srcset="banners/"+small_images+" 1x"+","+"banners/"+large_images+" 2x";};function events(events,observer){events.forEach(function(event){if(event.intersectionRatio>0){displayImages(event.target);observer.unobserve(event.target);}else{}});}
var cuisine=document.getElementById("restaurant-cuisine");cuisine.innerHTML=restaurant.cuisine_type;if(restaurant.operating_hours){fillRestaurantHoursHTML();}
DBHelper.fetchReviewsByRestaurantId(restaurant.id).then(function(reviews){return fillReviewsHTML(reviews);});};fillRestaurantHoursHTML=function fillRestaurantHoursHTML(){var operatingHours=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant.operating_hours;var hours=document.getElementById("restaurant-hours");for(var key in operatingHours){var row=document.createElement("tr");var day=document.createElement("td");day.innerHTML=key;row.appendChild(day);var time=document.createElement("td");time.innerHTML=operatingHours[key];row.appendChild(time);hours.appendChild(row);}};fillReviewsHTML=function fillReviewsHTML(){var reviews=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant.reviews;var container=document.getElementById("reviews-container");var title=document.createElement("h2");title.innerHTML="Reviews";container.appendChild(title);var id=parseInt(getParameterByName('id'));if(!reviews){var noReviews=document.createElement("p");noReviews.innerHTML="No reviews yet!";container.appendChild(noReviews);return;}
var ul=document.getElementById("reviews-list");reviews.forEach(function(review){ul.appendChild(createReviewHTML(review));});container.appendChild(ul);};createReviewHTML=function createReviewHTML(review){var li=document.createElement("li");li.tabIndex=0;var name=document.createElement("p");name.innerHTML=review.name;li.appendChild(name);var date=document.createElement("p");var convertedDate=new Date(review.createdAt).toLocaleString();date.innerHTML=convertedDate;li.appendChild(date);var rating=document.createElement("p");rating.innerHTML='Rating: '+review.rating;li.appendChild(rating);var comments=document.createElement("p");comments.innerHTML=review.comments;li.appendChild(comments);return li;};addReview=function addReview(){console.log("clicked submit");var url=window.location.href;var id=getParameterByName('id');var name=document.getElementById('reviewer_name').value;var rating=document.getElementById('select_rating');var rating_value=rating.options[rating.selectedIndex].value;var comment=document.getElementById('reviewer_comment').value;if(name==""){alert("Name must be filled out");return!1;}else if(comment==""){alert("Comment must be filled out");return!1;}else{var jsonToSend={"restaurant_id":id,"name":name,"createdAt":new Date(),"rating":rating_value,"comments":comment};var offline_obj={data:jsonToSend,name:'addReview',object_type:"review"};if(!navigator.onLine&&offline_obj.name==='addReview'){DBHelper.sendReviewsWhenOnline(offline_obj);var _container=document.getElementById("reviews-container");var _ul=document.getElementById("reviews-list");_ul.insertBefore(createReviewHTML(offline_obj.data),_ul.childNodes[0]);_container.appendChild(_ul);var reviewForm=document.getElementById('reviewForm');reviewForm.reset();return;}
console.log("sending reviews",jsonToSend);DBHelper.sendReviewsToServer(jsonToSend);var container=document.getElementById("reviews-container");var ul=document.getElementById("reviews-list");ul.insertBefore(createReviewHTML(jsonToSend),ul.childNodes[0]);container.appendChild(ul);var reviewForm=document.getElementById('reviewForm');reviewForm.reset();}};fillBreadcrumb=function fillBreadcrumb(){var restaurant=arguments.length>0&&arguments[0]!==undefined?arguments[0]:self.restaurant;var breadcrumb=document.getElementById("breadcrumb");var li=document.createElement("li");li.innerHTML=restaurant.name;breadcrumb.appendChild(li);};getParameterByName=function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)'),results=regex.exec(url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "));};